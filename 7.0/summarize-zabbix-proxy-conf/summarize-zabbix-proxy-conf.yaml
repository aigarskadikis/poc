zabbix_export:
  version: '7.0'
  template_groups:
    - uuid: 57b7ae836ca64446ba2c296389c009b7
      name: Templates/Modules
  templates:
    - uuid: a1a59fecd2c0482bb2eaa581634e696c
      template: 'summarize zabbix_proxy.conf'
      name: 'summarize zabbix_proxy.conf'
      groups:
        - name: Templates/Modules
      items:
        - uuid: fe4afbb92ecd4999b78c4791eae5e8ac
          name: 'Active lines'
          type: DEPENDENT
          key: active.lines
          delay: '0'
          value_type: LOG
          trends: '0'
          preprocessing:
            - type: JAVASCRIPT
              parameters:
                - |
                  var data = [];
                  var lines = value.match(/^([a-zA-Z0-9]+=.*)/gm);
                  var lines_num = lines.length;
                  for (i = 0; i < lines_num; i++) {
                    var row = {};
                    row["setting"] = lines[i].match(/^([a-zA-Z0-9]+)=.*/)[1];
                    row["value"] = lines[i].match(/^[a-zA-Z0-9]+=(.*)/)[1];
                    data.push(row);
                  }
                  return JSON.stringify(data);
          master_item:
            key: 'vfs.file.contents["/etc/zabbix/zabbix_proxy.conf",]'
          tags:
            - tag: raw
              value: zabbixproxy
        - uuid: 6649ed8ee0964274999546d6aab1522f
          name: zabbix_proxy.conf
          type: ZABBIX_ACTIVE
          key: 'vfs.file.contents["/etc/zabbix/zabbix_proxy.conf",]'
          delay: 8h
          history: '0'
          value_type: LOG
          trends: '0'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            - tag: raw
              value: zabbixproxy
      discovery_rules:
        - uuid: 278b2fb827314be0aacff11cf1a5f4ee
          name: conf
          type: DEPENDENT
          key: conf
          delay: '0'
          item_prototypes:
            - uuid: 1ca29cb56fc14afc822b8b7c04f12c67
              name: '{#SETTING}'
              type: DEPENDENT
              key: 'setting[{#SETTING}]'
              delay: '0'
              value_type: CHAR
              trends: '0'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$..[?(@.setting== ''{#SETTING}'')].theValue.first()'
              master_item:
                key: active.lines
              tags:
                - tag: conf
                  value: zabbixproxy
          master_item:
            key: active.lines
          lld_macro_paths:
            - lld_macro: '{#SETTING}'
              path: '$.[''setting'']'
